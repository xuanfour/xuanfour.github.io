---
layout: post
title: "Rails 常用方法函数"
date: 2018-10-11
categories: 程序设计
tags:
    - Rails
---

<div id="outline-container-orgf8b1df8" class="outline-2">
<h2 id="orgf8b1df8"><span class="section-number-2">1</span> 常用方法</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgc4eed76" class="outline-3">
<h3 id="orgc4eed76"><span class="section-number-3">1.1</span> <code>String.split</code></h3>
<div class="outline-text-3" id="text-1-1">
<p>
字符串拆分成数组。
</p>
</div>
</div>

<div id="outline-container-orgc97bad0" class="outline-3">
<h3 id="orgc97bad0"><span class="section-number-3">1.2</span> <code>Array.join</code></h3>
<div class="outline-text-3" id="text-1-2">
<p>
数组组合成字符串。
</p>
</div>
</div>

<div id="outline-container-org9cf3516" class="outline-3">
<h3 id="org9cf3516"><span class="section-number-3">1.3</span> <code>String.downcase</code></h3>
<div class="outline-text-3" id="text-1-3">
<p>
返回小写字符串。
</p>
</div>
</div>

<div id="outline-container-orgec8bf51" class="outline-3">
<h3 id="orgec8bf51"><span class="section-number-3">1.4</span> <code>String.upcase</code></h3>
<div class="outline-text-3" id="text-1-4">
<p>
返回大写字符串。
</p>
</div>
</div>

<div id="outline-container-orgdbbdc24" class="outline-3">
<h3 id="orgdbbdc24"><span class="section-number-3">1.5</span> <code>String.camelize</code></h3>
<div class="outline-text-3" id="text-1-5">
<p>
字符串蛇式转驼峰式，需 <code>ActiveSupport</code> 支持。
</p>
</div>
</div>

<div id="outline-container-orge0e71a9" class="outline-3">
<h3 id="orge0e71a9"><span class="section-number-3">1.6</span> <code>String.underscore</code></h3>
<div class="outline-text-3" id="text-1-6">
<p>
字符串驼峰式转蛇式，需 <code>ActiveSupport</code> 支持。
</p>
</div>
</div>

<div id="outline-container-orgb3b6bcc" class="outline-3">
<h3 id="orgb3b6bcc"><span class="section-number-3">1.7</span> <code>String.reverse</code></h3>
<div class="outline-text-3" id="text-1-7">
<p>
反转字符串内容。
</p>
</div>
</div>

<div id="outline-container-org4205991" class="outline-3">
<h3 id="org4205991"><span class="section-number-3">1.8</span> <code>Array.shuffle</code></h3>
<div class="outline-text-3" id="text-1-8">
<p>
返回乱序数组。
</p>
</div>
</div>

<div id="outline-container-orgbf999c5" class="outline-3">
<h3 id="orgbf999c5"><span class="section-number-3">1.9</span> <code>Object.inspect</code></h3>
<div class="outline-text-3" id="text-1-9">
<p>
返回被调用对象的字符串字面量。
</p>
</div>
</div>

<div id="outline-container-orgba20fd7" class="outline-3">
<h3 id="orgba20fd7"><span class="section-number-3">1.10</span> <code>Object.class</code></h3>
<div class="outline-text-3" id="text-1-10">
<p>
返回类。
</p>
</div>
</div>

<div id="outline-container-org2582610" class="outline-3">
<h3 id="org2582610"><span class="section-number-3">1.11</span> <code>Class.superclass</code></h3>
<div class="outline-text-3" id="text-1-11">
<p>
返回类的父类。
</p>
</div>
</div>

<div id="outline-container-org2e8d2be" class="outline-3">
<h3 id="org2e8d2be"><span class="section-number-3">1.12</span> <code>Hash.merge(other_hash)</code></h3>
<div class="outline-text-3" id="text-1-12">
<p>
返回一个新的散列，新散列是两个散列的合集，如果散列的键有重复，那么以
other_hash 的值为新散列的值。
</p>
</div>
</div>

<div id="outline-container-orgca466e2" class="outline-3">
<h3 id="orgca466e2"><span class="section-number-3">1.13</span> <code>singularize</code> 和 <code>pluralize</code></h3>
<div class="outline-text-3" id="text-1-13">
<ul class="org-ul">
<li><code>singularize</code> 获得一个字符串的单数</li>
<li><code>pluralize</code> 获得一个字符串的复数</li>
</ul>
</div>
</div>

<div id="outline-container-orgea69de8" class="outline-3">
<h3 id="orgea69de8"><span class="section-number-3">1.14</span> <code>head=、=render</code> 和 <code>redirect_to</code></h3>
<div class="outline-text-3" id="text-1-14">
<p>
从控制器的角度来看，创建 HTTP 响应有三种方法：
</p>

<ul class="org-ul">
<li>调用 <code>render</code> 方法，向浏览器发送一个完整的响应；</li>
<li>调用 <code>redirect_to</code> 方法，向浏览器发送一个 HTTP 重定向状态码；</li>
<li>调用 <code>head</code> 方法，向浏览器发送只含报头的响应；</li>
</ul>

<p>
从执行来看，有两种方式：
</p>

<ul class="org-ul">
<li><code>render</code> 是渲染，只是渲染了一个新的模版，没有执行相应的 action 方法。</li>
<li><code>redirect_to</code> 是跳转，实现 action
方法的跳转，向浏览器发起一个新的请求。</li>
</ul>

<p>
当 Rails 程序运行到 redirect_to 时，需要等待浏览器发送一个新的 http
请求再继续执行后面的代码。服务器发送 302 HTTP
状态码到浏览器并重定向，客户端(用户浏览器)将发送一个新的请求到服务器，action
将被执行。 运行 render 时不会执行指定 action 的代码，直接渲染页面。
</p>

<p>
控制器中的代码执行到 render 和 redirect_to
时，如果两者不是放在最后，并不会跳出并结束当前 action。
</p>

<p>
当涉及到表单提交时，数据库记录更新成功使用 redirect_to，更新失败使用
render
除了避免表单重复提交之外，如果表单提交失败，之前表单填写的信息还会存在，增强用户体验。
</p>
</div>
</div>

<div id="outline-container-orgc1a1cb2" class="outline-3">
<h3 id="orgc1a1cb2"><span class="section-number-3">1.15</span> <code>redirect_back</code></h3>
<div class="outline-text-3" id="text-1-15">
<p>
=redirect_back(fallback_location: jump_path)=回到上一次访问的页面，如果
HTTP_REFERER 来源不存在，跳转到参数指定的位置。
</p>
</div>
</div>


<div id="outline-container-org0569181" class="outline-3">
<h3 id="org0569181"><span class="section-number-3">1.16</span> HashWithIndifferentAccess</h3>
<div class="outline-text-3" id="text-1-16">
<p>
Rails 的 ActiveSupport::HashWithIndifferentAccess 需求文件：
</p>

<pre class="example">
require "active_support/core_ext/hash/indifferent_access"
</pre>

<p>
ruby 2.0 引入了 keyword arguments，方法的参数可以这么声明
</p>

<pre class="example">
def foo(bar: 'default')
  puts bar
end

foo # =&gt; 'default'
foo(bar: 'baz') # =&gt; 'baz'　　
</pre>

<p>
在某些情况下，参数可能已经保存到了一个 hash 中的时候，也可以这么调用
</p>

<pre class="example">
params = {bar: 'baz'}
foo(params) # =&gt; 'baz'
</pre>

<p>
在 rails 中，请求传过来的参数都会变成
HashWithIndifferentAccess，可以通过 Symbol 或者 String 作为 key 获取
value
</p>

<pre class="example">
params = {bar: 'baz'}.with_indifferent_access
params[:bar] # =&gt; 'baz'
params['bar'] # =&gt; 'baz'
</pre>

<p>
如果直接将 HashWithIndifferentAccess 作为参数传给 keyword arguments
的方法，是行不通的
</p>

<pre class="example">
params = {bar: 'baz'}.with_indifferent_access
foo(params) #  ArgumentError: wrong number of arguments (1 for 0)
</pre>

<p>
这是因为 HashWithIndifferentAccess 中是以 String 作为 key
的，本质上和以下的错误是一样的
</p>

<pre class="example">
params = {'bar' =&gt; 'baz'}
foo(params) #  ArgumentError: wrong number of arguments (1 for 0)
</pre>

<p>
所以创建 HashWithIndifferentAccess
</p>

<pre class="example">
hash = {bar: 'baz'}
params = hash.with_indifferent_access
# 或者
params = HashWithIndifferentAccess.new(hash)
</pre>

<p>
再转换成以 Symbol key 或 String key
</p>

<pre class="example">
foo(params.stringify_keys)      #  'baz'
foo(params.deep_stringify_keys) #  'baz'
foo(params.symbolize_keys)      #  :baz
foo(params.deep_symbolize_keys) #  :baz
</pre>

<p>
也可以尝试不安全的转换
</p>

<pre class="example">
hash = eval("{a: 'aaa', b: 'bbb'}")
</pre>
</div>
</div>
</div>


<div id="outline-container-org373796e" class="outline-2">
<h2 id="org373796e"><span class="section-number-2">2</span> References</h2>
<div class="outline-text-2" id="text-2">
<blockquote>
<p>
本文是我的学习笔记，内容参考了网上资源，为了方便自己查询使用，做了一些修改整理。
笔记内容摘录于下列文章，相应权利归属原作者，如有未列出的或有不妥，请联系我立即增补或删除。
</p>
</blockquote>
</div>
</div>
