---
layout: post
title: "MySQL 学习"
date: 2018-10-15
categories: 数据存储
tags:
    - MySQL
excerpt:
keywords: ""
---

<div id="outline-container-org66b90c0" class="outline-2">
<h2 id="org66b90c0"><span class="section-number-2">1</span> 数据库安装</h2>
<div class="outline-text-2" id="text-1">
<p>
安装前，我们可以检测系统是否自带安装 MySQL:
</p>

<div class="org-src-container">
<pre class="src src-shell">rpm -qa | grep mysql
</pre>
</div>

<p>
如果你系统有安装，那可以选择进行卸载:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#26222;&#36890;&#21024;&#38500;&#27169;&#24335;</span>
rpm -e mysql
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#24378;&#21147;&#21024;&#38500;&#27169;&#24335;&#65292;&#22914;&#26524;&#20351;&#29992;&#19978;&#38754;&#21629;&#20196;&#21024;&#38500;&#26102;&#65292;&#25552;&#31034;&#26377;&#20381;&#36182;&#30340;&#20854;&#23427;&#25991;&#20214;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#21017;&#29992;&#35813;&#21629;&#20196;&#21487;&#20197;&#23545;&#20854;&#36827;&#34892;&#24378;&#21147;&#21024;&#38500;</span>
rpm -e --nodeps mysql
</pre>
</div>

<p>
安装 MySQL：
</p>

<p>
接下来我们在 Centos7 系统下使用 yum 命令安装 MySQL，需要注意的是 CentOS 7 版本中 MySQL 数据库已从默认的程序列表中移除，所以在安装前我们需要先去官网下载 Yum 资源包，下载地址为：<a href="https://dev.mysql.com/downloads/repo/yum/">https://dev.mysql.com/downloads/repo/yum/</a>。
</p>

<div class="org-src-container">
<pre class="src src-shell">wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm
rpm -ivh mysql-community-release-el7-5.noarch.rpm
yum update
yum install mysql-server
</pre>
</div>

<p>
初始化 MySQL：
</p>

<div class="org-src-container">
<pre class="src src-shell">mysqld --initialize
</pre>
</div>

<p>
启动 MySQL：
</p>

<div class="org-src-container">
<pre class="src src-shell">systemctl start mysqld
</pre>
</div>

<p>
查看 MySQL 运行状态：
</p>

<div class="org-src-container">
<pre class="src src-shell">systemctl status mysqld
</pre>
</div>

<p>
验证 MySQL 安装
</p>

<p>
在成功安装 MySQL 后，一些基础表会表初始化，在服务器启动后，你可以通过简单的测试来验证 MySQL 是否工作正常。
</p>

<p>
使用 mysqladmin 工具来获取服务器状态：
</p>

<p>
使用 mysqladmin 命令俩检查服务器的版本, 在 linux 上该二进制文件位于 /usr/bin 目录，在 Windows 上该二进制文件位于 C:\mysql\bin。
</p>

<div class="org-src-container">
<pre class="src src-shell">mysql --version
mysqladmin --version
</pre>
</div>

<p>
使用 MySQL Client(Mysql 客户端) 执行简单的 SQL 命令
</p>

<p>
你可以在 MySQL Client(Mysql 客户端) 使用 mysql 命令连接到 MySQL 服务器上，默认情况下 MySQL 服务器的登录密码为空，所以本实例不需要输入密码。
</p>

<p>
命令如下：
</p>

<div class="org-src-container">
<pre class="src src-shell">mysql
</pre>
</div>

<p>
Mysql 安装后需要做的
</p>

<p>
Mysql 安装成功后，默认的 root 用户密码为空，你可以使用以下命令来创建 root 用户的密码：
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #4f97d7;">[</span>root@host<span style="color: #4f97d7;">]</span># mysqladmin -u root password <span style="color: #2d9574;">"new_password"</span>;
</pre>
</div>

<p>
现在你可以通过以下命令来连接到 Mysql 服务器：
</p>

<div class="org-src-container">
<pre class="src src-shell">mysql -u root -p
</pre>
</div>
</div>
</div>

<div id="outline-container-org6702747" class="outline-2">
<h2 id="org6702747"><span class="section-number-2">2</span> CentOS7 下安装 MySQL 完整示例</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#23433;&#35013;&#21069;&#30475;&#26159;&#21542;&#23433;&#35013;&#36807; mysql&#65292;</span>
yum list installed mysql*
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#22914;&#26524;&#26377;&#23601;&#29992; yum remove &#21368;&#36733; mysql</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#26597;&#30475; yum &#24211;&#19979;&#26159;&#21542;&#26377; mysql-server</span>
yum list | grep mysql &#25110; yum -y list mysql*
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#22914;&#26524;&#27809;&#26377;&#65288;&#19968;&#33324;&#22312; centos7 &#19979;&#27809;&#26377;&#65289;</span>
wget http://repo.mysql.com/mysql80-community-release-el7-1.noarch.rpm
sudo rpm -ivh mysql80-community-release-el7-1.noarch.rpm

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#28982;&#21518;&#23433;&#35013; mysql</span>
sudo yum install mysql-server
sudo yum install mysql-devel

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#22914;&#26524;&#26377; mysql-server&#65292;&#21017;&#25353;&#19979;&#38754;&#27493;&#39588;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#23433;&#35013; mysql &#23458;&#25143;&#31471;&#65306;</span>
sudo yum install mysql
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#23433;&#35013; mysql &#26381;&#21153;&#22120;&#31471;&#65306;</span>
sudo yum install mysql-server
sudo yum install mysql-devel

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#20462;&#25913;&#37197;&#32622;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">file: /etc/my.cnf</span>
<span style="color: #4f97d7;">[</span>mysqld<span style="color: #4f97d7;">]</span>
character-set-server=utf8mb4

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#28982;&#21518;&#21551;&#21160; mysql &#26381;&#21153;&#65292;&#21487;&#33021;&#38656;&#35201;&#36755;&#20837; root &#23494;&#30721;</span>
service mysqld start
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#30331;&#24405; mysql</span>
mysql -u root -p
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#21018;&#23433;&#35013;&#23494;&#30721;&#20026;&#31354;&#65292;&#30452;&#25509;&#25353;&#22238;&#36710;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#22914;&#26524;&#25552;&#31034;&#26435;&#38480;&#38169;&#35823;&#65292;&#26159;&#31532;&#19968;&#27425;&#21551;&#21160;&#21518;&#29983;&#25104;&#30340;&#38543;&#26426;&#23494;&#30721;&#65292;&#21487;&#20351;&#29992;&#19979;&#21015;&#21629;&#20196;&#26597;&#30475;</span>
grep <span style="color: #2d9574;">"temporary password"</span> /var/log/mysqld.log

<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#26597;&#30475;&#25968;&#25454;&#24211;&#65306;</span>
show databases;
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#22914;&#26524;&#25552;&#31034;&#38169;&#35823;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">===&gt; ERROR 1820 (HY000): You must reset your password</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">===&gt; using ALTER USER statement before executing this statement.</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#21487;&#20197;&#20351;&#29992;&#22914;&#19979;&#20004;&#31181;&#26041;&#24335;&#20462;&#25913;&#23494;&#30721;&#65306;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">1.</span>
SET <span style="color: #7590db;">PASSWORD</span> = PASSWORD<span style="color: #4f97d7;">(</span>&#8216;<span style="color: #a45bad;">12345678</span>&#8217;<span style="color: #4f97d7;">)</span>;
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">2.</span>
ALTER USER USER<span style="color: #4f97d7;">()</span> IDENTIFIED BY &#8216;<span style="color: #a45bad;">12345678</span>&#8217;;
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">===&gt; ERROR 1819 (HY000): Your password does not satisfy the current policy requirements</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#20986;&#29616;&#36825;&#20010;&#38169;&#20854;&#23454;&#26159;&#21644; validate_password_policy &#30340;&#20540;&#26377;&#20851;&#12290;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">MySQL &#23436;&#25972;&#30340;&#21021;&#22987;&#23494;&#30721;&#35268;&#21017;&#21487;&#20197;&#36890;&#36807;&#22914;&#19979;&#21629;&#20196;&#26597;&#30475;&#65306;</span>
use sys;
SHOW VARIABLES LIKE <span style="color: #2d9574;">'validate_password%'</span>;
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">validate_password_policy &#40664;&#35748;&#26159; 1&#65292;&#21363; MEDIUM&#65292;&#25152;&#20197;&#21018;&#24320;&#22987;&#35774;&#32622;&#30340;&#23494;&#30721;&#24517;&#39035;&#31526;&#21512;&#38271;&#24230;&#65292;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#19988;&#24517;&#39035;&#21547;&#26377;&#25968;&#23383;&#65292;&#23567;&#20889;&#25110;&#22823;&#20889;&#23383;&#27597;&#65292;&#29305;&#27530;&#23383;&#31526;&#12290;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#26377;&#26102;&#20505;&#65292;&#21482;&#26159;&#20026;&#20102;&#33258;&#24049;&#27979;&#35797;&#65292;&#19981;&#24819;&#23494;&#30721;&#35774;&#32622;&#24471;&#37027;&#20040;&#22797;&#26434;&#65292;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#35692;&#22914;&#35828;&#65292;&#25105;&#21482;&#24819;&#35774;&#32622; root &#30340;&#23494;&#30721;&#20026; 123456&#12290;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#24517;&#39035;&#20462;&#25913;&#20004;&#20010;&#20840;&#23616;&#21442;&#25968;&#65306;</span>
<span style="color: #4f97d7;">set</span> global <span style="color: #7590db;">validate_password_policy</span>=<span style="color: #a45bad;">0</span>;
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#36825;&#26679;&#65292;&#21028;&#26029;&#23494;&#30721;&#30340;&#26631;&#20934;&#23601;&#22522;&#20110;&#23494;&#30721;&#30340;&#38271;&#24230;&#20102;&#12290;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#36825;&#20010;&#30001; validate_password_length &#21442;&#25968;&#26469;&#20915;&#23450;&#12290;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#23494;&#30721;&#30340;&#38271;&#24230;&#26159;&#30001; validate_password_length &#20915;&#23450;&#30340;&#65292;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#32780; validate_password_length &#30340;&#35745;&#31639;&#20844;&#24335;&#26159;&#65306;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">validate_password_length = validate_password_number_count +</span>
<span style="color: #2aa1ae; background-color: #292e34;">#     </span><span style="color: #2aa1ae; background-color: #292e34;">validate_password_special_char_count +</span>
<span style="color: #2aa1ae; background-color: #292e34;">#     </span><span style="color: #2aa1ae; background-color: #292e34;">(2 * validate_password_mixed_case_count)</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">validate_password_number_count &#25351;&#23450;&#20102;&#23494;&#30721;&#20013;&#25968;&#25454;&#30340;&#38271;&#24230;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">validate_password_special_char_count &#25351;&#23450;&#20102;&#23494;&#30721;&#20013;&#29305;&#27530;&#23383;&#31526;&#30340;&#38271;&#24230;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">validate_password_mixed_case_count &#25351;&#23450;&#20102;&#23494;&#30721;&#20013;&#22823;&#23567;&#23383;&#27597;&#30340;&#38271;&#24230;&#12290;</span>
<span style="color: #4f97d7;">set</span> global <span style="color: #7590db;">validate_password_length</span>=<span style="color: #a45bad;">1</span>;
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#36825;&#20123;&#21442;&#25968;&#65292;&#40664;&#35748;&#20540;&#22343;&#20026; 1&#65292;&#25152;&#20197; validate_password_length &#26368;&#23567;&#20540;&#20026; 4&#65292;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#22914;&#26524;&#20320;&#26174;&#24615;&#25351;&#23450; validate_password_length &#30340;&#20540;&#23567;&#20110; 4&#65292;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#23613;&#31649;&#19981;&#20250;&#25253;&#38169;&#65292;&#20294; validate_password_length &#30340;&#20540;&#23558;&#35774;&#20026; 4&#12290;</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#21047;&#26032;&#31995;&#32479;&#24182;&#20351;&#29992;&#26032;&#23494;&#30721;&#27979;&#35797;&#30331;&#24405;</span>
flush privileges;
mysql -u root -p
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">&#22240;&#20026;&#23433;&#35013;&#20102; Yum Repository&#65292;&#20197;&#21518;&#27599;&#27425; yum &#25805;&#20316;&#37117;&#20250;&#33258;&#21160;&#26356;&#26032;&#65292;&#21487;&#20197;&#21368;&#36733;&#65306;</span>
sudo yum -y remove mysql80-community-release-el7-1.noarch.rpm
</pre>
</div>
</div>
</div>

<div id="outline-container-org287f712" class="outline-2">
<h2 id="org287f712"><span class="section-number-2">3</span> 启动及关闭 MySQL 服务器</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org9ad691a" class="outline-3">
<h3 id="org9ad691a"><span class="section-number-3">3.1</span> Windows 系统下</h3>
<div class="outline-text-3" id="text-3-1">
<p>
在 Windows 系统下，打开命令窗口(cmd)，进入 MySQL 安装目录的 bin 目录。
</p>

<p>
启动：
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #4f97d7;">cd</span> c:/mysql/bin
mysqld --console
</pre>
</div>

<p>
关闭：
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #4f97d7;">cd</span> c:/mysql/bin
mysqladmin -uroot shutdown
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd9ae254" class="outline-3">
<h3 id="orgd9ae254"><span class="section-number-3">3.2</span> Linux 系统下</h3>
<div class="outline-text-3" id="text-3-2">
<p>
首先，我们需要通过以下命令来检查 MySQL 服务器是否启动：
</p>

<div class="org-src-container">
<pre class="src src-shell">ps -ef | grep mysqld
</pre>
</div>

<p>
如果 MySql 已经启动，以上命令将输出 mysql 进程列表， 如果 mysql 未启动，你可以使用以下命令来启动 mysql 服务器:
</p>

<div class="org-src-container">
<pre class="src src-shell">./mysqld_safe &amp;
</pre>
</div>

<p>
如果你想关闭目前运行的 MySQL 服务器, 你可以执行以下命令:
</p>

<div class="org-src-container">
<pre class="src src-shell">./mysqladmin -u root -p shutdown
</pre>
</div>
</div>
</div>

<div id="outline-container-org0d483d2" class="outline-3">
<h3 id="org0d483d2"><span class="section-number-3">3.3</span> 打开客户端</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">
<pre class="src src-shell">mysql -u root -p
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3d15bca" class="outline-2">
<h2 id="org3d15bca"><span class="section-number-2">4</span> 用户设置</h2>
<div class="outline-text-2" id="text-4">
<p>
如果你需要添加 MySQL 用户，你只需要在 mysql 数据库中的 user 表添加新用户即可。
</p>

<p>
以下为添加用户的的实例，用户名为 guest，密码为 guest123，并授权用户可进行 SELECT, INSERT 和 UPDATE 操作权限：
</p>

<div class="org-src-container">
<pre class="src src-sql">use mysql;
<span style="color: #4f97d7; font-weight: bold;">INSERT</span> <span style="color: #4f97d7; font-weight: bold;">INTO</span> <span style="color: #4f97d7;">user</span> <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">host</span>, <span style="color: #4f97d7;">user</span>, password, select_priv, insert_priv, update_priv<span style="color: #4f97d7;">)</span>
           <span style="color: #4f97d7; font-weight: bold;">VALUES</span> <span style="color: #4f97d7;">(</span><span style="color: #2d9574;">'localhost'</span>, <span style="color: #2d9574;">'guest'</span>, PASSWORD<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">'guest123'</span><span style="color: #bc6ec5;">)</span>, <span style="color: #2d9574;">'Y'</span>, <span style="color: #2d9574;">'Y'</span>, <span style="color: #2d9574;">'Y'</span><span style="color: #4f97d7;">)</span>;
FLUSH <span style="color: #4f97d7; font-weight: bold;">PRIVILEGES</span>;
<span style="color: #4f97d7; font-weight: bold;">SELECT</span> <span style="color: #4f97d7; font-weight: bold;">host</span>, <span style="color: #4f97d7;">user</span>, password <span style="color: #4f97d7; font-weight: bold;">FROM</span> <span style="color: #4f97d7;">user</span> <span style="color: #4f97d7; font-weight: bold;">WHERE</span> <span style="color: #4f97d7;">user</span> = <span style="color: #2d9574;">'guest'</span>;
</pre>
</div>

<p>
在添加用户时，请注意使用 MySQL 提供的 PASSWORD() 函数来对密码进行加密。 你可以在以上实例看到用户密码加密后为：6f8c114b58f2ce9e.
</p>

<p>
注意：
</p>

<ul class="org-ul">
<li>在 MySQL5.7 中 user 表的 password 已换成了 authentication_string。</li>
<li>password() 加密函数已经在 8.0.11 中移除了，可以使用 MD5() 函数代替。</li>
<li>在注意需要执行 FLUSH PRIVILEGES 语句。 这个命令执行后会重新载入授权表。 如果你不使用该命令，你就无法使用新创建的用户来连接 mysql 服务器，除非你重启 mysql 服务器。</li>
</ul>

<div class="org-src-container">
<pre class="src src-sql">use mysql;
<span style="color: #4f97d7; font-weight: bold;">INSERT</span> <span style="color: #4f97d7; font-weight: bold;">INTO</span> <span style="color: #4f97d7;">user</span> <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">host</span>, <span style="color: #4f97d7;">user</span>, authentication_string, select_priv, insert_priv, update_priv<span style="color: #4f97d7;">)</span>
           <span style="color: #4f97d7; font-weight: bold;">VALUES</span> <span style="color: #4f97d7;">(</span><span style="color: #2d9574;">'localhost'</span>, <span style="color: #2d9574;">'guest'</span>, MD5<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">'guest123'</span><span style="color: #bc6ec5;">)</span>, <span style="color: #2d9574;">'Y'</span>, <span style="color: #2d9574;">'Y'</span>, <span style="color: #2d9574;">'Y'</span><span style="color: #4f97d7;">)</span>;
FLUSH <span style="color: #4f97d7; font-weight: bold;">PRIVILEGES</span>;
<span style="color: #4f97d7; font-weight: bold;">SELECT</span> <span style="color: #4f97d7; font-weight: bold;">host</span>, <span style="color: #4f97d7;">user</span>, authentication_string <span style="color: #4f97d7; font-weight: bold;">FROM</span> <span style="color: #4f97d7;">user</span> <span style="color: #4f97d7; font-weight: bold;">WHERE</span> <span style="color: #4f97d7;">user</span> = <span style="color: #2d9574;">'guest'</span>;
</pre>
</div>

<p>
你可以在创建用户时，为用户指定权限，在对应的权限列中，在插入语句中设置为 'Y' 即可，用户权限列表如下：
</p>

<div class="org-src-container">
<pre class="src src-text">Select_priv
Insert_priv
Update_priv
Delete_priv
Create_priv
Drop_priv
Reload_priv
Shutdown_priv
Process_priv
File_priv
Grant_priv
References_priv
Index_priv
Alter_priv
</pre>
</div>

<p>
另外一种添加用户的方法为通过 SQL 的 GRANT 命令，以下命令会给指定数据库 TUTORIALS 添加用户 zara，密码为 zara123。
</p>

<div class="org-src-container">
<pre class="src src-sql">use mysql;
<span style="color: #4f97d7; font-weight: bold;">GRANT</span> <span style="color: #4f97d7; font-weight: bold;">SELECT</span>,<span style="color: #4f97d7; font-weight: bold;">INSERT</span>,<span style="color: #4f97d7; font-weight: bold;">UPDATE</span>,<span style="color: #4f97d7; font-weight: bold;">DELETE</span>,<span style="color: #4f97d7; font-weight: bold;">CREATE</span>,<span style="color: #4f97d7; font-weight: bold;">DROP</span>
    -&gt; <span style="color: #4f97d7; font-weight: bold;">ON</span> TUTORIALS.*
    -&gt; <span style="color: #4f97d7; font-weight: bold;">TO</span> <span style="color: #2d9574;">'zara'</span>@<span style="color: #2d9574;">'localhost'</span>
    -&gt; IDENTIFIED <span style="color: #4f97d7; font-weight: bold;">BY</span> <span style="color: #2d9574;">'zara123'</span>;
</pre>
</div>

<p>
以上命令会在 mysql 数据库中的 user 表创建一条用户信息记录。
</p>

<p>
注意: MySQL 的 SQL 语句以分号 (;) 作为结束标识。
</p>
</div>
</div>

<div id="outline-container-org2859b92" class="outline-2">
<h2 id="org2859b92"><span class="section-number-2">5</span> MySQL 8.0 用户管理</h2>
<div class="outline-text-2" id="text-5">
<div class="org-src-container">
<pre class="src src-sql"># &#21019;&#24314;&#36134;&#21495;&#23494;&#30721;
<span style="color: #4f97d7; font-weight: bold;">create</span> <span style="color: #4f97d7;">user</span> `wangwei`@`<span style="color: #a45bad;">127</span>.<span style="color: #a45bad;">0</span>.<span style="color: #a45bad;">0</span>.<span style="color: #a45bad;">1</span>` identified <span style="color: #4f97d7; font-weight: bold;">by</span> <span style="color: #2d9574;">'passowrd'</span>;
# &#25480;&#20104;&#25152;&#26377;&#26435;&#38480;
<span style="color: #4f97d7; font-weight: bold;">grant</span> <span style="color: #4f97d7; font-weight: bold;">all</span> <span style="color: #4f97d7; font-weight: bold;">on</span> *.* <span style="color: #4f97d7; font-weight: bold;">to</span> `wangwei`@`<span style="color: #a45bad;">127</span>.<span style="color: #a45bad;">0</span>.<span style="color: #a45bad;">0</span>.<span style="color: #a45bad;">1</span>` <span style="color: #4f97d7; font-weight: bold;">with</span> <span style="color: #4f97d7; font-weight: bold;">grant</span> <span style="color: #4f97d7; font-weight: bold;">option</span>;
# &#25480;&#20104;&#26576;&#20010;&#25968;&#25454;&#24211;&#25152;&#26377;&#26435;&#38480;
<span style="color: #4f97d7; font-weight: bold;">grant</span> <span style="color: #4f97d7; font-weight: bold;">all</span> <span style="color: #4f97d7; font-weight: bold;">on</span> databasename.tablename <span style="color: #4f97d7; font-weight: bold;">to</span> `wangwei`@`<span style="color: #a45bad;">127</span>.<span style="color: #a45bad;">0</span>.<span style="color: #a45bad;">0</span>.<span style="color: #a45bad;">1</span>` <span style="color: #4f97d7; font-weight: bold;">with</span> <span style="color: #4f97d7; font-weight: bold;">grant</span> <span style="color: #4f97d7; font-weight: bold;">option</span>;
# &#21024;&#38500;&#26435;&#38480;
<span style="color: #4f97d7; font-weight: bold;">revoke</span> <span style="color: #4f97d7; font-weight: bold;">all</span> <span style="color: #4f97d7; font-weight: bold;">privileges</span> <span style="color: #4f97d7; font-weight: bold;">on</span> databasename.tablename <span style="color: #4f97d7; font-weight: bold;">from</span> <span style="color: #2d9574;">'username'</span>@<span style="color: #2d9574;">'host'</span>;
# &#20462;&#25913;&#23494;&#30721;
<span style="color: #4f97d7; font-weight: bold;">alter</span> <span style="color: #4f97d7;">user</span> <span style="color: #2d9574;">'root'</span>@<span style="color: #2d9574;">'localhost'</span> identified <span style="color: #4f97d7; font-weight: bold;">with</span> mysql_native_password <span style="color: #4f97d7; font-weight: bold;">by</span> <span style="color: #2d9574;">'&#20320;&#30340;&#23494;&#30721;'</span>;
<span style="color: #4f97d7; font-weight: bold;">alter</span> <span style="color: #4f97d7;">user</span> <span style="color: #2d9574;">'mydev'</span>@<span style="color: #2d9574;">'localhost'</span> identified <span style="color: #4f97d7; font-weight: bold;">by</span> <span style="color: #2d9574;">'MyDev123$'</span>;
# &#26597;&#30475;&#29992;&#25143;&#26435;&#38480;
show grants <span style="color: #4f97d7; font-weight: bold;">for</span> <span style="color: #2d9574;">'mydev'</span>@<span style="color: #2d9574;">'localhost'</span>;
</pre>
</div>
</div>

<div id="outline-container-org4e2707f" class="outline-3">
<h3 id="org4e2707f"><span class="section-number-3">5.1</span> MySQL 8.0 中带过期时间用户的创建：</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">CREATE</span> <span style="color: #4f97d7;">USER</span> `wangwei`@`<span style="color: #a45bad;">127</span>.<span style="color: #a45bad;">0</span>.<span style="color: #a45bad;">0</span>.<span style="color: #a45bad;">1</span>` IDENTIFIED <span style="color: #4f97d7; font-weight: bold;">BY</span> <span style="color: #2d9574;">'wangwei'</span> PASSWORD EXPIRE <span style="color: #ce537a; font-weight: bold;">INTERVAL</span> <span style="color: #a45bad;">90</span> <span style="color: #4f97d7; font-weight: bold;">DAY</span>;
<span style="color: #4f97d7; font-weight: bold;">GRANT</span> <span style="color: #4f97d7; font-weight: bold;">ALL</span> <span style="color: #4f97d7; font-weight: bold;">ON</span> *.* <span style="color: #4f97d7; font-weight: bold;">TO</span> `wangwei`@`<span style="color: #a45bad;">127</span>.<span style="color: #a45bad;">0</span>.<span style="color: #a45bad;">0</span>.<span style="color: #a45bad;">1</span>` <span style="color: #4f97d7; font-weight: bold;">WITH</span> <span style="color: #4f97d7; font-weight: bold;">GRANT</span> <span style="color: #4f97d7; font-weight: bold;">OPTION</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ed411e" class="outline-3">
<h3 id="org1ed411e"><span class="section-number-3">5.2</span> MySQL 8.0 修改用户密码：</h3>
<div class="outline-text-3" id="text-5-2">
</div>
<div id="outline-container-org60a0eb8" class="outline-4">
<h4 id="org60a0eb8"><span class="section-number-4">5.2.1</span> 密码过期时间管理</h4>
<div class="outline-text-4" id="text-5-2-1">
<p>
要全局建立自动密码到期策略，请使用 default_password_lifetime 系统变量。其默认值为 0，禁用自动密码过期。
</p>

<p>
如果值 default_password_lifetime 正整数 N，则表示允许的密码生存期，以便密码必须每天更改 N。可以加在配置文件中：
</p>

<ol class="org-ol">
<li>要建立全局策略，密码的使用期限大约为六个月，请在服务器 my.cnf 文件中使用以下行启动服务器：</li>
</ol>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7;">[</span>mysqld<span style="color: #4f97d7;">]</span>default_password_lifetime=<span style="color: #a45bad;">180</span>
</pre>
</div>

<ol class="org-ol">
<li>要建立全局策略，以便密码永不过期，请将其设置 default_password_lifetime 为 0：</li>
</ol>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7;">[</span>mysqld<span style="color: #4f97d7;">]</span>default_password_lifetime=<span style="color: #a45bad;">0</span>
</pre>
</div>

<p>
这个参数是可以动态设置并保存的：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">SET</span> PERSIST default_password_lifetime = <span style="color: #a45bad;">180</span>;<span style="color: #4f97d7; font-weight: bold;">SET</span> PERSIST default_password_lifetime = <span style="color: #a45bad;">0</span>;
</pre>
</div>

<p>
创建和修改带有密码过期的用户，帐户特定的到期时间设置示例：
</p>

<p>
要求每 90 天更换密码：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">CREATE</span> <span style="color: #4f97d7;">USER</span> <span style="color: #2d9574;">'wangwei'</span>@<span style="color: #2d9574;">'localhost'</span> PASSWORD EXPIRE <span style="color: #ce537a; font-weight: bold;">INTERVAL</span> <span style="color: #a45bad;">90</span> <span style="color: #4f97d7; font-weight: bold;">DAY</span>;
<span style="color: #4f97d7; font-weight: bold;">ALTER</span> <span style="color: #4f97d7;">USER</span> <span style="color: #2d9574;">'wangwei'</span>@<span style="color: #2d9574;">'localhost'</span> PASSWORD EXPIRE <span style="color: #ce537a; font-weight: bold;">INTERVAL</span> <span style="color: #a45bad;">90</span> <span style="color: #4f97d7; font-weight: bold;">DAY</span>;
</pre>
</div>

<p>
禁用密码过期：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">CREATE</span> <span style="color: #4f97d7;">USER</span> <span style="color: #2d9574;">' wangwei'</span>@<span style="color: #2d9574;">'localhost'</span> PASSWORD EXPIRE NEVER;
<span style="color: #4f97d7; font-weight: bold;">ALTER</span> <span style="color: #4f97d7;">USER</span> <span style="color: #2d9574;">'wangwei'</span>@<span style="color: #2d9574;">'localhost'</span> PASSWORD EXPIRE NEVER;
</pre>
</div>

<p>
遵循全局到期政策：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">CREATE</span> <span style="color: #4f97d7;">USER</span> <span style="color: #2d9574;">'wangwei'</span>@<span style="color: #2d9574;">'localhost'</span> PASSWORD EXPIRE <span style="color: #4f97d7; font-weight: bold;">DEFAULT</span>;
<span style="color: #4f97d7; font-weight: bold;">ALTER</span> <span style="color: #4f97d7;">USER</span> <span style="color: #2d9574;">'wangwei'</span>@<span style="color: #2d9574;">'localhost'</span> PASSWORD EXPIRE <span style="color: #4f97d7; font-weight: bold;">DEFAULT</span>;<span style="color: #a45bad;">1</span>.<span style="color: #a45bad;">3</span> MySQL &#29992;&#25143;&#23494;&#30721;&#37325;&#29992;&#31574;&#30053;&#35774;&#32622;
</pre>
</div>

<p>
MySQL 允许限制重复使用以前的密码。可以根据密码更改次数、已用时间或两者来建立重用限制。帐户的密码历史由过去分配的密码组成。
</p>

<p>
MySQL 可以限制从此历史记录中选择新密码：
</p>

<ol class="org-ol">
<li>如果根据密码更改次数限制帐户，则无法从指定数量的最新密码中选择新密码。例如，如果密码更改的最小数量设置为 3，则新密码不能与任何最近的 3 个密码相同。</li>

<li>如果帐户因时间的限制而被限制，则无法从历史记录中的新密码中选择新密码，该新密码不会超过指定的天数。例如，如果密码重用间隔设置为 60，则新密码不得在最近 60 天内选择的密码之间。</li>
</ol>

<p>
注意：空密码不记录在密码历史记录中，并随时可以重复使用。
</p>

<p>
要全局建立密码重用策略，请使用 password_history 和 password_reuse_interval 系统变量。要在服务器启动时指定变量值，请在服务器 my.cnf 文件中定义它们。
</p>

<p>
示例：
</p>

<p>
要禁止重复使用最近 6 个密码或密码超过 365 天的任何密码，请将这些行放入您的服务器 my.cnf 文件中：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7;">[</span>mysqld<span style="color: #4f97d7;">]</span>password_history=<span style="color: #a45bad;">6password_reuse_interval</span>=<span style="color: #a45bad;">365</span>
</pre>
</div>

<p>
要动态设置和保存配置，请使用如下所示的语句：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">SET</span> PERSIST password_history = <span style="color: #a45bad;">6</span>;
<span style="color: #4f97d7; font-weight: bold;">SET</span> PERSIST password_reuse_interval = <span style="color: #a45bad;">365</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5c95e72" class="outline-3">
<h3 id="org5c95e72"><span class="section-number-3">5.3</span> MySQL8.0 的角色管理</h3>
<div class="outline-text-3" id="text-5-3">
<p>
MySQL 角色是指定的权限集合。像用户帐户一样，角色可以拥有授予和撤消的权限。
</p>

<p>
可以授予用户帐户角色，授予该帐户与每个角色相关的权限。用户被授予角色权限，则该用户拥有该角色的权限。
</p>

<p>
以下列表总结了 MySQL 提供的角色管理功能：
</p>

<ul class="org-ul">
<li>CREATE ROLE 并 DROP ROLE 角色创建和删除；</li>
<li>GRANT 并 REVOKE 为用户和角色分配和撤销权限；</li>
<li>SHOW GRANTS 显示用户和角色的权限和角色分配；</li>
<li>SET DEFAULT ROLE 指定哪些帐户角色默认处于活动状态；</li>
<li>SET ROLE 更改当前会话中的活动角色。</li>
<li>CURRENT_ROLE()功能显示当前会话中的活动角色。</li>
</ul>
</div>

<div id="outline-container-org21ab17a" class="outline-4">
<h4 id="org21ab17a"><span class="section-number-4">5.3.1</span> 创建角色并授予用户角色权限</h4>
<div class="outline-text-4" id="text-5-3-1">
<p>
考虑如下几种场景：
</p>

<ul class="org-ul">
<li>应用程序使用名为 app_db 的数据库 。</li>
<li>与应用程序相关联，可以为创建和维护应用程序的开发人员以及管理员账户。</li>
<li>开发人员需要完全访问数据库。有的用户只需要读取权限，有的用户需要读取/写入权限。</li>
<li>为清楚区分角色的权限，将角色创建为所需权限集的名称。通过授权适当的角色，可以轻松地为用户帐户授予所需的权限。</li>
</ul>

<p>
要创建角色，请使用 CREATE ROLE：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">CREATE</span> <span style="color: #4f97d7; font-weight: bold;">ROLE</span> <span style="color: #2d9574;">'app_developer'</span>, <span style="color: #2d9574;">'app_read'</span>, <span style="color: #2d9574;">'app_write'</span>;
</pre>
</div>

<p>
角色名称与用户帐户名称非常相似，由格式中的用户部分和主机部分组成。主机部分，如果省略，则默认为%。用户和主机部分可以不加引号，除非它们包含特殊字符。与帐户名称不同，角色名称的用户部分不能为空。为角色分配权限，使用与为用户分配权限相同的语法执行：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">GRANT</span> <span style="color: #4f97d7; font-weight: bold;">ALL</span> <span style="color: #4f97d7; font-weight: bold;">ON</span> app_db.* <span style="color: #4f97d7; font-weight: bold;">TO</span> <span style="color: #2d9574;">'app_developer'</span>;
<span style="color: #4f97d7; font-weight: bold;">GRANT</span> <span style="color: #4f97d7; font-weight: bold;">SELECT</span> <span style="color: #4f97d7; font-weight: bold;">ON</span> app_db.* <span style="color: #4f97d7; font-weight: bold;">TO</span> <span style="color: #2d9574;">'app_read'</span>;
<span style="color: #4f97d7; font-weight: bold;">GRANT</span> <span style="color: #4f97d7; font-weight: bold;">INSERT</span>, <span style="color: #4f97d7; font-weight: bold;">UPDATE</span>, <span style="color: #4f97d7; font-weight: bold;">DELETE</span> <span style="color: #4f97d7; font-weight: bold;">ON</span> app_db.* <span style="color: #4f97d7; font-weight: bold;">TO</span> <span style="color: #2d9574;">'app_write'</span>;
<span style="color: #4f97d7; font-weight: bold;">CREATE</span> <span style="color: #4f97d7; font-weight: bold;">ROLE</span> <span style="color: #2d9574;">'app_developer'</span>, <span style="color: #2d9574;">'app_read'</span>, <span style="color: #2d9574;">'app_write'</span>;
</pre>
</div>

<p>
现在假设您最初需要一个开发人员帐户，两个需要只读访问权的用户以及一个需要读取/写入权限的用户。
</p>

<p>
使用 CREATEUSER 创建用户：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">CREATE</span> <span style="color: #4f97d7;">USER</span> <span style="color: #2d9574;">'dev1'</span>@<span style="color: #2d9574;">'localhost'</span> IDENTIFIED <span style="color: #4f97d7; font-weight: bold;">BY</span> <span style="color: #2d9574;">'dev1pass'</span>;
<span style="color: #4f97d7; font-weight: bold;">CREATE</span> <span style="color: #4f97d7;">USER</span> <span style="color: #2d9574;">'read_user1'</span>@<span style="color: #2d9574;">'localhost'</span> IDENTIFIED <span style="color: #4f97d7; font-weight: bold;">BY</span> <span style="color: #2d9574;">'read_user1pass'</span>;
<span style="color: #4f97d7; font-weight: bold;">CREATE</span> <span style="color: #4f97d7;">USER</span> <span style="color: #2d9574;">'read_user2'</span>@<span style="color: #2d9574;">'localhost'</span> IDENTIFIED <span style="color: #4f97d7; font-weight: bold;">BY</span> <span style="color: #2d9574;">'read_user2pass'</span>;
<span style="color: #4f97d7; font-weight: bold;">CREATE</span> <span style="color: #4f97d7;">USER</span> <span style="color: #2d9574;">'rw_user1'</span>@<span style="color: #2d9574;">'localhost'</span> IDENTIFIED <span style="color: #4f97d7; font-weight: bold;">BY</span> <span style="color: #2d9574;">'rw_user1pass'</span>;
</pre>
</div>

<p>
要为每个用户分配其所需的权限，可以使用 GRANT 与刚才显示的形式相同的语句，但这需要列举每个用户的个人权限。
</p>

<p>
相反，使用 GRANT 允许授权角色而非权限的替代语法：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">GRANT</span> <span style="color: #2d9574;">'app_developer'</span> <span style="color: #4f97d7; font-weight: bold;">TO</span> <span style="color: #2d9574;">'dev1'</span>@<span style="color: #2d9574;">'localhost'</span>;
<span style="color: #4f97d7; font-weight: bold;">GRANT</span> <span style="color: #2d9574;">'app_read'</span> <span style="color: #4f97d7; font-weight: bold;">TO</span> <span style="color: #2d9574;">'read_user1'</span>@<span style="color: #2d9574;">'localhost'</span>, <span style="color: #2d9574;">'read_user2'</span>@<span style="color: #2d9574;">'localhost'</span>;
<span style="color: #4f97d7; font-weight: bold;">GRANT</span> <span style="color: #2d9574;">'app_read'</span>, <span style="color: #2d9574;">'app_write'</span> <span style="color: #4f97d7; font-weight: bold;">TO</span> <span style="color: #2d9574;">'rw_user1'</span>@<span style="color: #2d9574;">'localhost'</span>;
</pre>
</div>

<p>
结合角色所需的读取和写入权限，在 GRANT 中授权 rw_user1 用户读取和写入的角色。
</p>

<p>
在 GRANT 授权角色的语法和授权用户的语法不同：有一个 ON 来区分角色和用户的授权，有 ON 的为用户授权，而没有 ON 用来分配角色。
</p>

<p>
由于语法不同，因此不能在同一语句中混合分配用户权限和角色。（允许为用户分配权限和角色，但必须使用单独的 GRANT 语句，每种语句的语法都要与授权的内容相匹配。）
</p>
</div>
</div>

<div id="outline-container-orgcdfe12f" class="outline-4">
<h4 id="orgcdfe12f"><span class="section-number-4">5.3.2</span> 检查角色权限</h4>
<div class="outline-text-4" id="text-5-3-2">
<p>
要验证分配给用户的权限，使用 SHOW GRANTS。例如：
</p>

<div class="org-src-container">
<pre class="src src-sql">SHOW GRANTS <span style="color: #4f97d7; font-weight: bold;">FOR</span> <span style="color: #2d9574;">'dev1'</span>@<span style="color: #2d9574;">'localhost'</span>;
</pre>
</div>

<p>
但是，它会显示每个授予的角色，而不会将其显示为角色所代表的权限。如果要显示角色权限，添加一个 USING 来显示：
</p>

<div class="org-src-container">
<pre class="src src-sql">SHOW GRANTS <span style="color: #4f97d7; font-weight: bold;">FOR</span> <span style="color: #2d9574;">'dev1'</span>@<span style="color: #2d9574;">'localhost'</span> <span style="color: #4f97d7; font-weight: bold;">USING</span> <span style="color: #2d9574;">'app_developer'</span>;
</pre>
</div>

<p>
同样验证其他类型的用户：
</p>

<div class="org-src-container">
<pre class="src src-sql">SHOW GRANTS <span style="color: #4f97d7; font-weight: bold;">FOR</span> <span style="color: #2d9574;">'read_user1'</span>@<span style="color: #2d9574;">'localhost'</span> <span style="color: #4f97d7; font-weight: bold;">USING</span> <span style="color: #2d9574;">'app_read'</span>;
</pre>
</div>

<p>
撤消角色或角色权限
</p>

<p>
正如可以授权某个用户的角色一样，可以从帐户中撤销这些角色：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">REVOKE</span> <span style="color: #4f97d7; font-weight: bold;">role</span> <span style="color: #4f97d7; font-weight: bold;">FROM</span> <span style="color: #4f97d7;">user</span>;
</pre>
</div>

<p>
REVOKE 可以用于角色修改角色权限。这不仅影响角色本身权限，还影响任何授予该角色的用户权限。假设想临时让所有用户只读，使用 REVOKE 从该 app_write 角色中撤消修改权限 ：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">REVOKE</span> <span style="color: #4f97d7; font-weight: bold;">INSERT</span>, <span style="color: #4f97d7; font-weight: bold;">UPDATE</span>, <span style="color: #4f97d7; font-weight: bold;">DELETE</span> <span style="color: #4f97d7; font-weight: bold;">ON</span> app_db.* <span style="color: #4f97d7; font-weight: bold;">FROM</span> <span style="color: #2d9574;">'app_write'</span>;
</pre>
</div>

<p>
碰巧，某个角色完全没有任何权限，正如可以看到的那样 SHOW GRANTS（这个语句可以和角色一起使用，而不仅仅是查询用户权限可用）：
</p>

<div class="org-src-container">
<pre class="src src-sql">SHOW GRANTS <span style="color: #4f97d7; font-weight: bold;">FOR</span> <span style="color: #2d9574;">'app_write'</span>;
</pre>
</div>

<p>
从角色中撤销权限会影响到该角色中任何用户的权限，因此 rw_user1 现在已经没有表修改权限（INSERT，UPDATE，和 DELETE 权限已经没有了）：
</p>

<div class="org-src-container">
<pre class="src src-sql">SHOW GRANTS <span style="color: #4f97d7; font-weight: bold;">FOR</span> <span style="color: #2d9574;">'rw_user1'</span>@<span style="color: #2d9574;">'localhost'</span> <span style="color: #4f97d7; font-weight: bold;">USING</span> <span style="color: #2d9574;">'app_read'</span>, <span style="color: #2d9574;">'app_write'</span>;
</pre>
</div>


<p>
实际上，rw_user1 读/写用户已成为只读用户。对于被授予 app_write 角色的任何其他用户也会发生这种情况，说明修改使用角色而不必修改个人帐户的权限。
</p>

<p>
要恢复角色的修改权限，只需重新授予它们即可：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">GRANT</span> <span style="color: #4f97d7; font-weight: bold;">INSERT</span>, <span style="color: #4f97d7; font-weight: bold;">UPDATE</span>, <span style="color: #4f97d7; font-weight: bold;">DELETE</span> <span style="color: #4f97d7; font-weight: bold;">ON</span> app_db.* <span style="color: #4f97d7; font-weight: bold;">TO</span> <span style="color: #2d9574;">'app_write'</span>;
</pre>
</div>

<p>
现在 rw_user1 再次具有修改权限，就像授权该 app_write 角色的其他任何帐户一样。
</p>

<p>
删除角色
</p>

<p>
要删除角色，请使用 DROP ROLE：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">DROP</span> <span style="color: #4f97d7; font-weight: bold;">ROLE</span> <span style="color: #2d9574;">'app_read'</span>, <span style="color: #2d9574;">'app_write'</span>;
</pre>
</div>

<p>
删除角色会从授权它的每个帐户中撤消该角色。
</p>

<p>
角色和用户在实际中的应用
</p>

<p>
假设遗留应用开发项目在 MySQL 中的角色出现之前开始，因此与该项目相关联的所有用户都是直接授予权限（而不是授予角色权限）。其中一个帐户是最初被授予权限的开发者用户，如下所示：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">CREATE</span> <span style="color: #4f97d7;">USER</span> <span style="color: #2d9574;">'old_app_dev'</span>@<span style="color: #2d9574;">'localhost'</span> IDENTIFIED <span style="color: #4f97d7; font-weight: bold;">BY</span> <span style="color: #2d9574;">'old_app_devpass'</span>;
<span style="color: #4f97d7; font-weight: bold;">GRANT</span> <span style="color: #4f97d7; font-weight: bold;">ALL</span> <span style="color: #4f97d7; font-weight: bold;">ON</span> old_app.* <span style="color: #4f97d7; font-weight: bold;">TO</span> <span style="color: #2d9574;">'old_app_dev'</span>@<span style="color: #2d9574;">'localhost'</span>;
</pre>
</div>

<p>
如果此开发人员离开项目，则有必要将权限分配给其他用户，或者项目参与人增多，则可能需要多个用户。以下是解决该问题的一些方法：
</p>

<p>
不使用角色：更改帐户密码，以便原始开发人员不能使用它，并让新的开发人员使用该帐户：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">ALTER</span> <span style="color: #4f97d7;">USER</span> <span style="color: #2d9574;">'old_app_dev'</span>@<span style="color: #2d9574;">'localhost'</span> IDENTIFIED <span style="color: #4f97d7; font-weight: bold;">BY</span> <span style="color: #2d9574;">'new_password'</span>;
</pre>
</div>

<p>
使用角色：锁定帐户以防止任何人使用它来连接服务器：
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #4f97d7; font-weight: bold;">ALTER</span> <span style="color: #4f97d7;">USER</span> <span style="color: #2d9574;">'old_app_dev'</span>@<span style="color: #2d9574;">'localhost'</span> ACCOUNT LOCK;
</pre>
</div>

<p>
然后将该帐户视为角色。对于每个新开发项目的开发者，创建一个新帐户并授予其原始开发者帐户：
</p>

<p>
CREATE USER 'new_app_dev1'@'localhost' IDENTIFIED BY 'new_password';
GRANT 'old_app_dev'@'localhost' TO 'new_app_dev1'@'localhost';
</p>

<p>
其效果是将原始开发者帐户权限分配给新帐户。
</p>

<p>
MySQL8.0 的用户和角色管理也越来越像 Oracle 了，8.0 中有不少新的特性，变化还是很大的，需要 DBA 不断的学习和测试，更新对 MySQL 新版的认知，更好地运维 MySQL 数据库。未来 MySQL 数据库自治和智能数据库是必然发展趋势，对 DBA 来说是解放，也是挑战。
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org651ece6" class="outline-2">
<h2 id="org651ece6"><span class="section-number-2">6</span> /etc/my.cnf 文件配置</h2>
<div class="outline-text-2" id="text-6">
<p>
一般情况下，你不需要修改该配置文件，该文件默认配置如下：
</p>

<p>
#+end_src ini
[mysqld]
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
</p>

<p>
[mysql.server]
user=mysql
basedir=/var/lib
</p>

<p>
[safe_mysqld]
err-log=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid
#+end_src
</p>

<p>
在配置文件中，你可以指定不同的错误日志文件存放的目录，一般你不需要改动这些配置。
</p>
</div>
</div>

<div id="outline-container-orgbafe47b" class="outline-2">
<h2 id="orgbafe47b"><span class="section-number-2">7</span> MySQL 常见命令</h2>
<div class="outline-text-2" id="text-7">
<p>
以下列出了使用 Mysql 数据库过程中常用的命令：
</p>

<div class="org-src-container">
<pre class="src src-sql">USE &#25968;&#25454;&#24211;&#21517; :
# &#36873;&#25321;&#35201;&#25805;&#20316;&#30340; Mysql &#25968;&#25454;&#24211;&#65292;&#20351;&#29992;&#35813;&#21629;&#20196;&#21518;&#25152;&#26377; Mysql &#21629;&#20196;&#37117;&#21482;&#38024;&#23545;&#35813;&#25968;&#25454;&#24211;&#12290;
SHOW DATABASES:
# &#21015;&#20986; MySQL &#25968;&#25454;&#24211;&#31649;&#29702;&#31995;&#32479;&#30340;&#25968;&#25454;&#24211;&#21015;&#34920;&#12290;
SHOW TABLES:
# &#26174;&#31034;&#25351;&#23450;&#25968;&#25454;&#24211;&#30340;&#25152;&#26377;&#34920;&#65292;&#20351;&#29992;&#35813;&#21629;&#20196;&#21069;&#38656;&#35201;&#20351;&#29992; use &#21629;&#20196;&#26469;&#36873;&#25321;&#35201;&#25805;&#20316;&#30340;&#25968;&#25454;&#24211;&#12290;
SHOW COLUMNS <span style="color: #4f97d7; font-weight: bold;">FROM</span> &#25968;&#25454;&#34920;:
# &#26174;&#31034;&#25968;&#25454;&#34920;&#30340;&#23646;&#24615;&#65292;&#23646;&#24615;&#31867;&#22411;&#65292;&#20027;&#38190;&#20449;&#24687; &#65292;&#26159;&#21542;&#20026; <span style="color: #4f97d7; font-weight: bold;">NULL</span>&#65292;&#40664;&#35748;&#20540;&#31561;&#20854;&#20182;&#20449;&#24687;&#12290;
SHOW INDEX <span style="color: #4f97d7; font-weight: bold;">FROM</span> &#25968;&#25454;&#34920;:
# &#26174;&#31034;&#25968;&#25454;&#34920;&#30340;&#35814;&#32454;&#32034;&#24341;&#20449;&#24687;&#65292;&#21253;&#25324; <span style="color: #4f97d7; font-weight: bold;">PRIMARY</span> <span style="color: #4f97d7; font-weight: bold;">KEY</span><span style="color: #4f97d7;">&#65288;</span>&#20027;&#38190;<span style="color: #4f97d7;">&#65289;</span>&#12290;
SHOW <span style="color: #4f97d7; font-weight: bold;">TABLE</span> STATUS <span style="color: #4f97d7; font-weight: bold;">LIKE</span> <span style="color: #4f97d7;">[</span><span style="color: #4f97d7; font-weight: bold;">FROM</span> db_name<span style="color: #4f97d7;">]</span> <span style="color: #4f97d7;">[</span><span style="color: #4f97d7; font-weight: bold;">LIKE</span> <span style="color: #2d9574;">'pattern'</span><span style="color: #4f97d7;">]</span> \G:
# &#35813;&#21629;&#20196;&#23558;&#36755;&#20986; Mysql &#25968;&#25454;&#24211;&#31649;&#29702;&#31995;&#32479;&#30340;&#24615;&#33021;&#21450;&#32479;&#35745;&#20449;&#24687;&#12290;
</pre>
</div>

<p>
数据库 CRUD
</p>

<div class="org-src-container">
<pre class="src src-sql"># &#26174;&#31034;&#25968;&#25454;&#24211;
show databases;
# &#36873;&#25321;&#25968;&#25454;&#24211;
use dbname;
# &#21019;&#24314;&#25968;&#25454;&#24211;
crate database dbname;
# &#21019;&#24314;&#25968;&#25454;&#24211;
<span style="color: #4f97d7; font-weight: bold;">drop</span> database dbname;
</pre>
</div>
</div>
</div>

<div id="outline-container-org9392b14" class="outline-2">
<h2 id="org9392b14"><span class="section-number-2">8</span> References</h2>
<div class="outline-text-2" id="text-8">
<p>
&gt; 本文是我的学习笔记，内容参考了网上资源，为了方便自己查询使用，做了一些修改整理。
&gt; 笔记内容摘录于下列文章，相应权利归属原作者，如有未列出的或有不妥，请联系我立即增补或删除。
</p>

<ul class="org-ul">
<li><a href="http://www.runoob.com/mysql/mysql-tutorial.html">http://www.runoob.com/mysql/mysql-tutorial.html</a></li>
<li><a href="https://www.sohu.com/a/229885311_610509">https://www.sohu.com/a/229885311_610509</a></li>
</ul>
</div>
</div>
