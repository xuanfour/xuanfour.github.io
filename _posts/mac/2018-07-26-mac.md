---
layout:     post
title:      "Mac 安装使用"
date:       2017-07-26
categories: mac
author:     "xuanfour"
header-img: "img/post-bg-unix-linux.jpg"
tags:
    - mac
    - iterm2
---

# Mac 安装使用

## 目录

* [安装配置](#安装配置)
  * [brew](#brew)
  * [安装 rbenv ruby rails](#安装-rbenv-ruby-rails)
  * [安装 pyenv 和 python](#安装-pyenv-和-python)
  * [安装视频播放器](#安装视频播放器)
* [Terminal](#Terminal)
  * [文件查找](#文件查找)
  * [iTerm2 中使用 lszrz](#iterm2-中使用-lszrz)
* [References](#references)

## 安装配置

### brew

* brew 主要用来下载一些不带界面的命令行下的工具和第三方库来进行二次开发
* brew cask 主要用来下载一些带界面的应用软件，下载好后会自动安装，并能在mac中直接运行使用
* brew install curl 可以安装curl第三方库，这样你在开发时就可以使用它的库来进行开发
* brew cask install chrome 可以安装谷歌浏览器应用程序，可直接运行
* brew 偏管理第三方库和命令行工具方面的东东
* brew cask 可以看作是苹果官方 app store 的补充，是一个众多贡献者们维护的非苹果官方软件商店，你也可以在这里下mac软件用

### 安装 brew

我们可以用 brew 命令来更新 OSX 系统，brew 命令类似于 RHEL 的 yum 和 ubuntu 的 apt-get 命令，OSX没有自带 brew，登陆 Homebrew 网站，找到 ruby 代码来安装 brew：

```ruby
ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
```

### 更新Homebrew

要获取最新的包的列表，首先得更新 Homebrew 自己。这可以用 brew update 办到。

```bash
brew update
```

### 更新包

要获取最新的包的列表，首先得更新 Homebrew 自己。这可以用 brew update 办到。

```bash
brew outdated
```

### 更新需要更新的包

```bash
brew upgrade             # 更新所有的包
brew upgrade $FORMULA    # 更新指定的包
```

### 清理旧版本

一般情况下，新版本安装了，旧版本就不需要了。我会用 brew cleanup 清理旧版本和缓存文件。Homebrew 只会清除比当前安装的包更老的版本，所以不用担心有些包没更新但被删了。

```bash
brew cleanup             # 清理所有包的旧版本
brew cleanup $FORMULA    # 清理指定包的旧版本
brew cleanup -n          # 查看可清理的旧版本包，不执行实际操作
```

### 锁定不想更新的包

如果经常更新的话，brew update 一次更新所有的包是非常方便的。但我们有时候会担心自动升级把一些不希望更新的包更新了。数据库就属于这一类，尤其是 PostgreSQL 跨 minor 版本升级都要迁移数据库的。我们更希望找个时间单独处理它。这时可用 brew pin 去锁定这个包，然后 brew update 就会略过它了。

```bash
brew pin $FORMULA      # 锁定某个包
brew unpin $FORMULA    # 取消锁定
```

### 其他几个常用命令

brew info 可以查看包的相关信息，最有用的应该是包依赖和相应的命令。比如 Nginx 会提醒你怎么加 launchctl ，PostgreSQL 会告诉你如何迁移数据库。这些信息会在包安装完成后自动显示，如果忘了的话可以用这个命令很方便地查看。

```bash
brew info $FORMULA    # 显示某个包的信息
brew info             # 显示安装了包数量，文件数量，和总占用空间

brew deps # 可以显示包的依赖关系，我常用它来查看已安装的包的依赖，然后判断哪些包是可以安全删除的。
brew deps --installed --tree # 查看已安装的包的依赖，树形显示
```

> [返回目录](#目录)

### 安装 rbenv ruby rails

```bash
# 安装rbenv
git clone https://github.com/sstephenson/rbenv.git ~/.rbenv
source ~/.bash_profile 
# 确认rbenv的版本
rbenv -v
# 更新 rbenv
cd "$(rbenv root)" && git pull

# 配置 rbenv
# 然后把下面的代码放到 ~/.bash_profile 里
export PATH="$HOME/.rbenv/bin:$PATH"
eval "$(rbenv init -)"
# 注意：Unubtu请放到 ~/.bashrc 里, zsh用户是 ~/.zshrc
执行配置
source ~/.bash_profile
# 或者重开一个终端

# 安装插件 ruby-build
# 通常安装 ruby 最新版需要安装 ruby-build 插件用来编译安装 ruby
mkdir -p "$(rbenv root)"/plugins
git clone https://github.com/rbenv/ruby-build.git "$(rbenv root)"/plugins/ruby-build
# 更新插件 ruby-build
cd "$(rbenv root)"/plugins/ruby-build && git pull

# 安装插件 rbenv-gemset
# 用来管理 gemset, 可选, 因为有 bundler 也没什么必要
git clone git://github.com/jamis/rbenv-gemset.git  "$(rbenv root)"/plugins/rbenv-gemset

# 安装插件 rbenv-update
# 通过 rbenv update 命令来更新 rbenv 以及所有插件, 推荐
git clone git://github.com/rkh/rbenv-update.git "$(rbenv root)"/plugins/rbenv-update

# 安装插件 rbenv-china-mirror
# 使用 Ruby China 的镜像安装 Ruby, 国内用户推荐
git clone git://github.com/AndorChen/rbenv-china-mirror.git "$(rbenv root)"/plugins/rbenv-china-mirror


# 安装 ruby
rbenv install --list  # 列出所有 ruby 版本
rbenv install 1.9.3-p392     # 安装 1.9.3-p392
rbenv install jruby-1.7.3    # 安装 jruby-1.7.3
# 解决无法在 irb 中输入中文的方法
RUBY_CONFIGURE_OPTS="--with-readline-dir=/usr/lib" rbenv install 2.5.0
# 列出版本
rbenv versions               # 列出安装的版本
rbenv version                # 列出正在使用的版本

# 设置版本
# rbenv 支持以下三种 Ruby 版本的环境管理：
# global：设置全局的 Ruby 版本，换句话说，所有的 shell 都将使用该 Ruby 版本。
# local：为本地的一个特定项目设置 Ruby 版本，注意这将覆盖全局设置。
# shell：针对 shell 设置 Ruby 版本，该设置将覆盖 global 和 local 设置。

rbenv global 1.9.3-p392      # 默认使用 1.9.3-p392
# rbenv shell 1.9.3-p392       # 当前的 shell 使用 1.9.3-p392, 会设置一个 `RBENV_VERSION` 环境变量
# rbenv local jruby-1.7.3      # 当前目录使用 jruby-1.7.3, 会生成一个 `.rbenv-version` 文件

# ruby 配置
$XCFG/nix/ruby/linkruby.sh

# 安装插件
gem update --system
gem install bundler
gem install rails
```

### 安装 pyenv 和 python

可以用 brew 来安装 pyenv 的最新版本，而且会自动下载依赖包：

```bash
brew install pyenv
pyenv -v
# 查看帮助
pyenv help
```

```bash
# 添加到 `~/.bash_profile` 或 `~/.zprofile` 文件里
export PYENV_ROOT=$HOME/.pyenv
# 添加到 `~/.bashrc` 或 `~/.zshrc` 文件里
if which pyenv >/dev/null; then eval "$(pyenv init -)"; fi
# zsh 运行命令使配置生效
source ~/.zprofile && source ~/.zshrc
# bash 运行命令使配置生效
source ~/.bash_profile && source ~/.bashrc
```

#### 安装 zlib 依赖

```bash
brew install zlib
# 如果编译程序有问题，尝试下列操作
# 1. 增加编译选项设置
# For compilers to find this software you may need to set:
#   LDFLAGS:  -L/usr/local/opt/zlib/lib
#   CPPFLAGS: -I/usr/local/opt/zlib/include
# For pkg-config to find this software you may need to set:
#   PKG_CONFIG_PATH: /usr/local/opt/zlib/lib/pkgconfig
# 2. 将 zlib 的头文件及库文件添加至系统默认的路径
ln -s /usr/local/opt/zlib/include/* /usr/local/include
ln -s /usr/local/opt/zlib/lib/* /usr/local/lib
ln -s /usr/local/opt/zlib/lib/pkgconfig/* /usr/local/lib/pkgconfig
```

#### pyenv 使用指南

pyenv versions 查看系统的上安装的 Python 版本。 `*` 表示当前目录正在使用的版本,其中 的 system 表示系统自带的 Python 版本：

```bash
# 查看本机版本信息
pyenv versions
# 显示如下
# *system (set by /Users/username/.pyenv/version)
# 安装其他版本的 Python。 例如安装 3.7.0 版本：
# 显示可以安装的列表
pyenv install -l  
# 安装 python
pyenv install 2.7.15
pyenv install 3.7.0
# 更新本地数据库
pyenv rehash
# 查看本机版本信息
pyenv versions
```

国内网络环境如果下载不下来的话，可以把显示的下载地址的文件用自己电脑的迅雷下载下来，
然后传到 `~/.pyenv/cache` 里（cache 文件夹没有的话手动创建一个），
然后执行 `pyenv install x.x.x` 就可以了。 也可以使用阿里云来加速下载：`vim ~/.pip/pip.conf`

```ini
# 内容如下
[global]
index-url=http://mirrors.aliyun.com/pypi/simple/
[install]
trusted-host=mirrors.aliyun.com
```

#### pyenv 的其他操作

```bash
# 卸载指定的包：
pyenv uninstall 3.7.0
# 更改本机版本，重启不会造成再次更改
pyenv global 3.7.0
python version
#==> Python 3.7.0
# 仅对当前目录及子目录生效
pyenv local system
python version
#==> Python 2.7.10
#  更改本shell的版本，临时生效，优先级高于global，local的也高于global，都是临时生效
python shell 3.7.0
```

#### pyenv 命令

| 命令                   | 说明                       |
| --------------------- | -------------------------- |
| pyenv version         | 查看当前系统使用的python版本 |
| pyenv versions        | 查看当前系统拥有的python版本 |
| pyenv install 3.4.1   | 安装3.4.1，可使用-v参数查看详细输出 |
| pyenv uninstall 3.4.1 | 卸载 |
| pyenv local 3.4.1     | local仅对当前目录及子目录生效，告诉当前目录使用版本2.7.5， |
| pyenv global          | 告诉全局环境使用某个版本，为了不破坏系统环境，不建议使用global设置全局版本 |
| pyenv rehash          | 重建环境，每次增删版本或带有可执行文件的包（如 pip）以后，都应该执行一次本命令 |

#### pyenv-virtualenv 安装

##### 安装

```bash
brew install pyenv-virtualenv
```

修改 `~/bashrc` 或 `~/.zshrc`, 添加以下内容

```bash
if which pyenv-virtualenv-init >/dev/null; then eval "$(pyenv virtualenv-init -)"; fi
```

##### 使用

```bash
# 创建虚拟环境
pyenv virtualenv 3.7.0 env37
pyenv virtualenv 2.7.15 env27
# 显示虚拟环境
pyenv virtualenvs
# 使用虚拟环境及退出虚拟环境，可能需要重启 shell
pyenv activate env27
pyenv deactivate
# 如果报错：Failed to activate virtualenv.
# 可以尝试使用下列命令
source activate env27
source deactivate
# 删除已存在的
pyenv uninstall env27
```

## Terminal

### locate

```bash
# mac 下更新数据库命令是
sudo /usr/libexec/locate.updatedb
# mac 下使用不要使用通配符，locate 自动将包含关键字的文件都检索
locate temp
```

> [返回目录](#目录)

### 安装视频播放器

#### iina

```bash
brew cask install iina
```

> [返回目录](#目录)

## Terminal

### lszrz

* 不论是发送还是接收，，都是在服务器端输入命令执行的。
* 无法传输大于 4G 的文件。
* 使用 tmux 或其他多路终端屏幕可能会失败，尝试在服务器上增加 -e 选项以强制在传输过程中转义更多字符。
* 使用 expect 或 rlogin 可能会失败，因为它期望双方之间的大多数干净的 8 位连接。

**注：本人在 mac + zsh + iterm2 环境里使用成功，但尝试在 tmux 环境中使用未成功！**

#### 安装 lrzsz

```bash
brew install lrzsz
```

#### 下载 iTerm2 支持脚本

```bash
cd /usr/local/bin
sudo curl -O https://raw.githubusercontent.com/mmastrac/iterm2-zmodem/master/iterm2-recv-zmodem.sh
sudo curl -O https://raw.githubusercontent.com/mmastrac/iterm2-zmodem/master/iterm2-send-zmodem.sh
sudo chmod +x iterm2*
```

#### 设置 iTerm2 Trigger

在 iTerm2 的 Preferences 中，选择 `Profiles—>Default—>Advanced—>Triggers—>Edit`，设置如下 trigger

```text
Regular expression: rz waiting to receive.\*\*B0100
Action: Run Silent Coprocess
Parameters: /usr/local/bin/iterm2-send-zmodem.sh
Instant: checked

Regular expression: \*\*B00000000000000
Action: Run Silent Coprocess
Parameters: /usr/local/bin/iterm2-recv-zmodem.sh
Instant: checked
```

#### 发送文件到远端服务器

* 在远端服务器执行 `rz`
* 本地选择文件传输
* 等待传输指示消失

#### 接收远端服务器的文件

* 在远端服务器执行 `sz filename1 filename2 … filenameN`
* 本地选择目录保存
* 等待传输指示消失

> [返回目录](#目录)

## References

> 本文是我的学习笔记，内容参考了网上资源，为了方便自己查询使用，做了一些修改整理。
> 笔记内容摘录于下列文章，相应权利归属原作者，如有未列出的或有不妥，请联系我立即增补或删除。

* <https://www.jianshu.com/p/7122982f8516>

> [返回目录](#目录)
