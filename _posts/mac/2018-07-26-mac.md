---
layout:     post
title:      "Mac 安装使用"
date:       2017-07-26
categories: mac
author:     "xuanfour"
header-img: "img/post-bg-unix-linux.jpg"
tags:
    - mac
    - iterm2
---

> MacBook Pro 使用学习笔记。

# Mac 安装使用

## 目录

* [安装配置](#安装配置)
  * [安装 brew](#安装-brew)
  * [安装 pyenv 和 python](#安装-pyenv-和-python)
* [Terminal](#Terminal)
  * [文件查找](#文件查找)
  * [iTerm2 中使用 lszrz](#iterm2-中使用-lszrz)

## 安装配置

### 安装 brew

我们可以用 brew 命令来更新 OSX 系统，brew 命令类似于 RHEL 的 yum 和 ubuntu 的 apt-get 命令，OSX没有自带 brew，登陆 Homebrew 网站，找到 ruby 代码来安装 brew：

```ruby
ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
```

* 升级到新版本的：homebrew：brew update
* 安装软件包：brew install XXXXX
* 更新软件包：brew upgrade XXXX，如果不写具体的软件包就是更新所有可更新的软件包。

### 安装 pyenv 和 python

可以用 brew 来安装 pyenv 的最新版本，而且会自动下载依赖包：

```bash
brew install pyenv
pyenv -v
# 查看帮助
pyenv help
```

```bash
# 添加到 `~/.bash_profile` 或 `~/.zprofile` 文件里
export PYENV_ROOT=$HOME/.pyenv
# 添加到 `~/.bashrc` 或 `~/.zshrc` 文件里
if which pyenv >/dev/null; then eval "$(pyenv init -)"; fi
# zsh 运行命令使配置生效
source ~/.zprofile && source ~/.zshrc
# bash 运行命令使配置生效
source ~/.bash_profile && source ~/.bashrc
```

#### 安装 zlib 依赖

```bash
brew install zlib
# 如果编译程序有问题，尝试下列操作
# 1. 增加编译选项设置
# For compilers to find this software you may need to set:
#   LDFLAGS:  -L/usr/local/opt/zlib/lib
#   CPPFLAGS: -I/usr/local/opt/zlib/include
# For pkg-config to find this software you may need to set:
#   PKG_CONFIG_PATH: /usr/local/opt/zlib/lib/pkgconfig
# 2. 将 zlib 的头文件及库文件添加至系统默认的路径
ln -s /usr/local/opt/zlib/include/* /usr/local/include
ln -s /usr/local/opt/zlib/lib/* /usr/local/lib
ln -s /usr/local/opt/zlib/lib/pkgconfig/* /usr/local/lib/pkgconfig
```

#### pyenv 使用指南

pyenv versions 查看系统的上安装的 Python 版本。 `*` 表示当前目录正在使用的版本,其中 的 system 表示系统自带的 Python 版本：

```bash
# 查看本机版本信息
pyenv versions
# 显示如下
# *system (set by /Users/username/.pyenv/version)
# 安装其他版本的 Python。 例如安装 3.7.0 版本：
# 显示可以安装的列表
pyenv install -l  
# 安装 python
pyenv install 2.7.15
pyenv install 3.7.0
# 更新本地数据库
pyenv rehash
# 查看本机版本信息
pyenv versions
```

国内网络环境如果下载不下来的话，可以把显示的下载地址的文件用自己电脑的迅雷下载下来，
然后传到 `~/.pyenv/cache` 里（cache 文件夹没有的话手动创建一个），
然后执行 `pyenv install x.x.x` 就可以了。 也可以使用阿里云来加速下载：`vim ~/.pip/pip.conf`

```ini
# 内容如下
[global]
index-url=http://mirrors.aliyun.com/pypi/simple/
[install]
trusted-host=mirrors.aliyun.com
```

#### pyenv 的其他操作

```bash
# 卸载指定的包：
pyenv uninstall 3.7.0
# 更改本机版本，重启不会造成再次更改
pyenv global 3.7.0
python version
#==> Python 3.7.0
# 仅对当前目录及子目录生效
pyenv local system
python version
#==> Python 2.7.10
#  更改本shell的版本，临时生效，优先级高于global，local的也高于global，都是临时生效
python shell 3.7.0
```

#### pyenv 命令

| 命令                   | 说明                       |
| --------------------- | -------------------------- |
| pyenv version         | 查看当前系统使用的python版本 |
| pyenv versions        | 查看当前系统拥有的python版本 |
| pyenv install 3.4.1   | 安装3.4.1，可使用-v参数查看详细输出 |
| pyenv uninstall 3.4.1 | 卸载 |
| pyenv local 3.4.1     | local仅对当前目录及子目录生效，告诉当前目录使用版本2.7.5， |
| pyenv global          | 告诉全局环境使用某个版本，为了不破坏系统环境，不建议使用global设置全局版本 |
| pyenv rehash          | 重建环境，每次增删版本或带有可执行文件的包（如 pip）以后，都应该执行一次本命令 |

#### pyenv-virtualenv 安装

##### 安装

```bash
brew install pyenv-virtualenv
```

修改 `~/bashrc` 或 `~/.zshrc`, 添加以下内容

```bash
if which pyenv-virtualenv-init >/dev/null; then eval "$(pyenv virtualenv-init -)"; fi
```

##### 使用

```bash
# 创建虚拟环境
pyenv virtualenv 3.7.0 env37
pyenv virtualenv 2.7.15 env27
# 显示虚拟环境
pyenv virtualenvs
# 使用虚拟环境及退出虚拟环境，可能需要重启 shell
pyenv activate env27
pyenv deactivate
# 如果报错：Failed to activate virtualenv.
# 可以尝试使用下列命令
source activate env27
source deactivate
# 删除已存在的
pyenv uninstall env27
```

## Terminal

### locate

```bash
# mac 下更新数据库命令是
sudo /usr/libexec/locate.updatedb
# mac 下使用不要使用通配符，locate 自动将包含关键字的文件都检索
locate temp
```

> [返回目录](#目录)

## Terminal

### lszrz

* 不论是发送还是接收，，都是在服务器端输入命令执行的。
* 无法传输大于 4G 的文件。
* 使用 tmux 或其他多路终端屏幕可能会失败，尝试在服务器上增加 -e 选项以强制在传输过程中转义更多字符。
* 使用 expect 或 rlogin 可能会失败，因为它期望双方之间的大多数干净的 8 位连接。

**注：本人在 mac + zsh + iterm2 环境里使用成功，但尝试在 tmux 环境中使用未成功！**

#### 安装 lrzsz

```bash
brew install lrzsz
```

#### 下载 iTerm2 支持脚本

```bash
cd /usr/local/bin
sudo curl -O https://raw.githubusercontent.com/mmastrac/iterm2-zmodem/master/iterm2-recv-zmodem.sh
sudo curl -O https://raw.githubusercontent.com/mmastrac/iterm2-zmodem/master/iterm2-send-zmodem.sh
sudo chmod +x iterm2*
```

#### 设置 iTerm2 Trigger

在 iTerm2 的 Preferences 中，选择 `Profiles—>Default—>Advanced—>Triggers—>Edit`，设置如下 trigger

```text
Regular expression: rz waiting to receive.\*\*B0100
Action: Run Silent Coprocess
Parameters: /usr/local/bin/iterm2-send-zmodem.sh
Instant: checked

Regular expression: \*\*B00000000000000
Action: Run Silent Coprocess
Parameters: /usr/local/bin/iterm2-recv-zmodem.sh
Instant: checked
```

#### 发送文件到远端服务器

* 在远端服务器执行 `rz`
* 本地选择文件传输
* 等待传输指示消失

#### 接收远端服务器的文件

* 在远端服务器执行 `sz filename1 filename2 … filenameN`
* 本地选择目录保存
* 等待传输指示消失

> [返回目录](#目录)
