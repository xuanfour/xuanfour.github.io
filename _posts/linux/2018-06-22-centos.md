---
layout:     post
title:      "CentOS 7 安装使用"
subtitle:   "阿里云主机的安装配置"
date:       2015-06-28
categories: linux
author:     "xuanfour"
header-img: "img/post-bg-unix-linux.jpg"
tags:
    - linux
    - centos
    - ssh
    - rbenv
    - rails
    - ruby
    - nodejs
---

> 趁着打折，买了个阿里云主机玩。记录一下整个 CentOS 的安装配置过程，避免遗忘。

# CentOS 7 安装使用

## 目录

* [安装配置](#安装配置)
  * [增加用户](#增加用户)
  * [设置 sudo](#设置-sudo)
  * [修改主机名称](#修改主机名称)
  * [ssh key 登录](#ssh-key-登录)
  * [配置国内 yum 源](#配置国内-yum-源)
  * [配置国内 epel 源](#配置国内-epel-源)
  * [更新源](#更新源)
  * [安装 git](#安装-git)
  * [下载配置文件](#下载配置文件)
  * [安装 zsh](#安装-zsh)
  * [初始化系统启动文件](#初始化系统启动文件)
  * [安装 lrzsz](#安装-lrzsz)
  * [安装 tmux](#安装-tmux)
  * [安装 rbenv ruby rails](#安装-rbenv-ruby-rails)
  * [安装 node](#安装-node)
  * [安装 pyenv 和 python](#安装-pyenv-和-python)
  * [安装 vim](#安装-vim)
* [使用](#使用)
  * [检查磁盘空间](#检查磁盘空间)
  * [检查目录空间](#检查目录空间)
* [References](#references)

## 安装配置

### 增加用户

```bash
adduser xuanfour
passwd xuanfour
```

> [返回目录](#目录)

### 设置 sudo

```bash
# 切换到超级用户
su -
vim /etc/sudoers
# 找到 root ALL=(ALL) ALL，在下方插入新行，使用 x! 强制保存并退出
xuanfour ALL=(ALL) ALL
```

> [返回目录](#目录)

### 修改主机名称

```bash
sudo hostnamectl set-hostname newhostname
# 或者
sudo vim /etc/hostname
sudo vim /etc/hosts
# 重启
sudo reboot
```

> [返回目录](#目录)

### ssh key 登录

```bash
# 本地
scp -r ~/.ssh xuanfour@wozouwokan.com:/home/xuanfour/.ssh
# 如果需要同时复制 git 配置文件
scp ~/.gitconfig xuanfour@wozouwokan.com:/home/xuanfour/
scp ~/.gitignore_global xuanfour@wozouwokan.com:/home/xuanfour/
# 远程
cat xuanfour_mbp.pub >> authorized_keys
chmod 600 ~/.ssh/*
chmod 644 ~/.ssh/*.pub
chmod 700 ~/.ssh
# 本地
ssh xuanfour@wozouwokan.com
```

> [返回目录](#目录)

### 配置国内 yum 源

```bash
# 进入 /etc/yum.repos.d/ 目录下，新建一个 repo_bak 目录，用于保存系统中原来的repo文件
cd /etc/yum.repos.d/
sudo mkdir repo_bak
sudo mv *.repo repo_bak/
# 配置使用网易和阿里的开源镜像
sudo wget http://mirrors.aliyun.com/repo/Centos-7.repo
sudo  wget http://mirrors.163.com/.help/CentOS7-Base-163.repo
# 清除系统 yum 缓存并生成新的缓存
sudo yum clean all
sudo yum makecache
```

> [返回目录](#目录)

### 配置国内 epel 源

```bash
yum list | grep epel-release
sudo yum install -y epel-release
# 安装成功，比原来多了一个 epel.repo 和 epel-testing.repo 文件
ls
# ==> Centos-7.repo  CentOS-Base-163.repo  epel.repo  epel-testing.repo  repo.bak
# 使用阿里开源镜像提供的 epel 源
sudo wget -O /etc/yum.repos.d/epel-7.repo http://mirrors.aliyun.com/repo/epel-7.repo
# 安装成功，比原来多了一个 epel-7.repo 文件
ls
# ==> CentOS7-Base-163.repo  Centos-7.repo  epel-7.repo  epel.repo  epel-testing.repo  repo_bak
# 再次清除系统 yum 缓存，并重新生成新的缓存
sudo yum clean all
sudo yum makecache
```

> [返回目录](#目录)

### 更新源

```bash
sudo yum update -y
```

> [返回目录](#目录)

### 安装 git

```bash
sudo yum install git
```

> [返回目录](#目录)

### 下载配置文件

```bash
# 远程
mkdir -p ~/xhome/dep
cd ~/xhome
git clone git@gitee.com:xuanfour/cfg.git
$XCFG/devkit/git/linkgit.sh
# 本地
scp -r ~/xhome/dep/theme xuanfour@wozouwokan.com:/home/xuanfour/xhome/dep/theme
# 远程
ln -s ~/xhome/dep/theme/dircolors-solarized/dircolors.ansi-dark ~/.dir_colors
```

> [返回目录](#目录)

### 安装 zsh

```bash
# 安装 zsh
sudo yum install -y zsh
# 设置默认 shell
chsh -s /bin/zsh
# 显示当前 shell： /bin/zsh
echo $SHELL
# 安装 oh-my-zsh:
git clone git://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh
# 安装 autojump
sudo yum install autojump
# 如果提示错误，没有那个文件或目录: /etc/profile.d/autojump.zsh
wget https://raw.githubusercontent.com/joelthelion/autojump/master/bin/autojump.zsh -O /etc/profile.d/autojump.zsh
sed -i 's/--add/-a/g' /etc/profile.d/autojump.zsh
```

> [返回目录](#目录)

### 初始化系统启动文件

```bash
$XCFG/lnx/os/addsettings.sh
sudo reboot
```

> [返回目录](#目录)

### 安装 lrzsz

```bash
sudo yum install lrzsz
```

> [返回目录](#目录)

### 安装 tmux

```bash
# 安装依赖包
sudo yum install -y libevent-devel
sudo yum install -y ncurses-devel
sudo yum install -y glibc-static

# 安装 tmux，可能版本较低，需要手工下载
sudo yum install -y tmux
# 或者手工下载安装 tmux
mkdir -p ~/Downloads/installed/lnx
cd ~/Downloads/installed/lnx
git clone https://github.com/tmux/tmux.git
cd tmux
sh autogen.sh
./configure && make
sudo make install
# 如果提示 aclocal failed，需要安装 automake
sudo yum install -y automake
# 如果曾经编译过，需要清理
make clean

# 配置 tmux
git clone https://github.com/gpakosz/.tmux.git ~/.tmux
# 安装 tmux 插件管理器
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
$XCFG/nix/tmux/linktmux.sh
tmux
# 在 tmux 里使用下列快捷键安装插件
prefix shift-i
# 在 tmux 里使用下列快捷键编辑 ~/.tmux.conf.local
prefix e
# 在 tmux 里使用下列快捷键重载配置
prefix r
```

> [返回目录](#目录)

### 安装 rbenv ruby rails

```bash
sudo yum update -y
sudo yum install -y git bzip2 openssl-devel readline-devel zlib-devel sqlite sqlite-devel gcc-c++
```

**注：更详细的情况请参考 [Mac 安装使用](/mac/2017/07/26/mac/index.html#安装-rbenv-ruby-rails)**

> [返回目录](#目录)

### 安装 node

```bash
# 安装 nvm
curl https://raw.githubusercontent.com/creationix/nvm/v0.30.2/install.sh | bash
执行配置
source ~/.bashrc
# 或者重开一个终端
nvm --version

# 查看 node 版本并安装
nvm ls-remote node
nvm install v10.5.0
node -v

# 安装切换各版本 node/npm
#安装最新稳定版
nvm install stable
# 设置默认 node 版本
nvm alias default 10.6.0
# 切换版本
nvm use node

# 使用 cnpm 和淘宝源
npm install -g cnpm --registry=https://registry.npm.taobao.org

# 在全局环境中安装 grunt-cli
npm install -g grunt-cli
```

> [返回目录](#目录)

### 安装 pyenv 和 python

#### 安装 pyenv

```bash
# 安装依赖
yum -y install gcc gcc-c++ make git patch openssl-devel zlib-devel readline-devel sqlite-devel bzip2-devel bzip2-libs
# 安装开发包以支持编译环境，否则会报错 `没有找到 python.h`
sudo yum install python-devel
sudo yum install python36-devel
# 安装 pyenv 和 virtualenv 插件
curl -L https://raw.github.com/yyuu/pyenv-installer/master/bin/pyenv-installer | bash
pyenv -v
pyenv help
# 添加到 `~/.bash_profile` 或 `~/.zprofile` 文件里
export PYENV_ROOT=$HOME/.pyenv
# 添加到 `~/.bashrc` 或 `~/.zshrc` 文件里
if which pyenv >/dev/null; then eval "$(pyenv init -)"; fi
# zsh 运行命令使配置生效
source ~/.zprofile && source ~/.zshrc
# bash 运行命令使配置生效
source ~/.bash_profile && source ~/.bashrc
```

**注：更详细的情况请参考 [Mac 安装使用](/mac/2017/07/26/mac/index.html#安装-pyenv-和-python)**

#### 不使用 pyenv 安装 python

```bash
# 不使用 pyenv 安装 python3
yum search python3
sudo yum install python36
sudo ln -sf /usr/bin/python3.6 /usr/bin/python3
sudo ln -sf /usr/bin/python3.6m /usr/bin/python3m
```

#### 安装 python 时报错

```bash
# 错误：ModuleNotFoundError: No module named ‘_ctypes’
# 解决
sudo yum update
sudo yum upgrade
sudo yum install gcc gcc-c++
sudo yum install zlib zlib-devel
sudo yum install libffi-devel
```

> [返回目录](#目录)

### 安装 vim

```bash
# 本地
scp -r ~/xhome/dep/vim xuanfour@wozouwokan.com:/home/xuanfour/xhome/dep/vim

# 找到vim 8 的repository，并且放到本地
cd /etc/yum.repos.d/
sudo wget  https://copr.fedorainfracloud.org/coprs/mcepl/vim8/repo/epel-7/mcepl-vim8-epel-7.repo
# 查看 repo 文件，如果 gpgchek=1 是 enable 的，需要导入 gpk 的认证文件
sudo rpm --import  https://copr-be.cloud.fedoraproject.org/results/mcepl/vim8/pubkey.gpg
# 有时候 vim-minimal 有冲突，卸载冲突 rpm，重新升级。
sudo yum erase vim-minimal
# 注意！删除 vim-minimal 可能会影响 sudo，在安装 vim 完成后重新安装 sudo
su -
yum update vim
yum install sudo

# 如果用yum查找源中的VIM包，不知安装哪个合适。
yum search vim
# 到已安装VIM的系统中查看VIM属于哪个软件包：
which vim
#>> /usr/bin/vim
rpm -qf /usr/bin/vim
#>> vim-enhanced-7.0.109-7.el5
# 安装 vim
yum install vim-enhanced
# 进入 vim，运行 `:BundleClean :BundleInstall :BundleUpdate` 三次插件清理、安装、更新
# 进入 vim 插件 LeaderF 安装目录，运行 `./install.sh` 编译安装检索插件
```

> [返回目录](#目录)

### 检查磁盘空间

```bash
# 显示所有存储系统空间使用情况,同时显示存储系统的文件系统类型
df -aT
# 显示指定文件系统的空间使用情况
df -t ext3
# 人性化显示各存储空间大小
df -ah
# 有时候挂载了网络文件系统，若只想看本机的文件系统用如下命令
df -ahlT
# 查看某个文件系统的磁盘使用情况
df -h /dev/cdrom
```

> [返回目录](#目录)

### 检查目录空间

```bash
# 查看当前文件夹大小
du -sh
# 查看当前文件及文件中包含的子文件夹大小
du -ch
# 查看文件的大小
du -h test1.txt
# 同时查看多个文件的大小
du -h test1.txt test2.txt
```

> [返回目录](#目录)

## References

> [返回目录](#目录)
